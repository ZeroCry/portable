{
  "build-drives.js": "function build_drives(r,e,i,s){var d=console.log.bind(console),a=path.resolve(\"\"+(r.dest?r.dest:\"./\"))+\"/\";mkdir(a);for(var o in r.drives){d(\"Bulding drives: \"+o);var v=r.drives[o],n=new Drive;if(!(v.layers instanceof Array&&v.layers.length))throw Error(\"No layers provided for dirve: \"+o);for(var l=0;l<v.layers.length;l++){var t=v.layers[l],f=a+t+\".nodefs.json\",u=fs.readFileSync(f).toString();n.addLayer(JSON.parse(u))}var y=a+o+\".nodefs.js\";n.write(y),d(\"Saving drive: \"+y)}}var Drive=require(\"./Drive\"),fs=require(\"fs\"),path=require(\"path\"),mkdir=require(\"./mkdir\");module.exports=build_drives;",
  "build-layers.js": "function build_layers(r,e,a,l){var o=console.log.bind(console),i=path.resolve(\"\"+(r.dest?r.dest:\"./\"))+\"/\";mkdir(i);var s={};for(var n in r.layers){o(\"Bulding layer: \"+n);var d=r.layers[n],t=s[n]=new Layer(d.base?d.base:\"\");if(!(d.globs instanceof Array&&d.globs.length))throw Error(\"No layer globs defined for layer: \"+n);t.addByGlobs(d.glob);var y=i+n+\".nodefs.json\",b=t.write(y);o(\"Saving layer: \"+y),o(\"Size: \"+b),o(\"\\n\")}return s}var Layer=require(\"./Layer\"),path=require(\"path\"),mkdir=require(\"./util/mkdir\");module.exports=build_layers;",
  "build.js": "var log=require(\"./log\"),Builder=function(){function r(){}return r.buildLayers=function(r,e){e||(e=r.layers);for(var i in e.layers){var n=e.getLayer(i);log.info(\"Building layer: \"+i),n.build();var l=n.write(r.destinationFolder);log.info(\"Saving layer: \"+l)}},r.mergeLayers=function(r){},r.buildBundles=function(r,e){for(var i in e.bundles){var n=e.bundles[i];n.build()}},r.prototype.watch=function(){},r}();exports.Builder=Builder;",
  "bundle.js": "var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);n.prototype=t.prototype,e.prototype=new n},log=require(\"./log\"),layer=require(\"./layer\"),fs=require(\"fs\"),events=require(\"events\"),Bundle=function(e){function t(t,n){e.call(this),this.name=\"\",this.layers=new layer.Collection,this.output=\"\",this.extension=\"js\",this.mimeType=\"application/javascript\",this.defaultBundler=\"browser\",this.name=t,this.man=n}return __extends(t,e),t.prototype.validate=function(e){if(!(e.volumes&&e.volumes instanceof Array&&e.volumes.length))throw Error('Bundle \"'+this.name+'\" volumes not defined.')},t.prototype.setConfig=function(e){var t=this;this.validate(e);e.target||(e.target=this.defaultBundler),e.props||(e.props={}),this.conf=e,e.volumes[0]instanceof Array||(e.volumes=[e.volumes]),this.conf.volumes.forEach(function(e){var n=e[1];t.layers.addLayer(t.man.layers.getLayer(n))})},t.prototype.build=function(){var e=this,t=this;log.info(\"Building bundle: \"+this.name),this.conf.volumes.forEach(function(n){var i=n[1],r=e.man.layers.getLayer(i);r instanceof layer.Layer&&(r.build(),t.layers.addLayer(r))}),this.conf.volumes.forEach(function(n){var i=n[1],r=e.man.layers.getLayer(i);r instanceof layer.LayerMerged&&t.layers.addLayer(r)}),this.bundle()},t.prototype.getBundlerFunction=function(e){try{return require(\"./bundle/bundle-\"+e)}catch(t){try{return require(\"portable-bundle-\"+e)}catch(t){try{return require(e)}catch(t){throw Error('Bundle \"'+this.name+'\" could not find bundler: '+e)}}}},t.prototype.bundle=function(){var e=this.conf.target?this.conf.target:this.defaultBundler,t=this.getBundlerFunction(e);this.output=t(this,this.conf.props)},t.prototype.write=function(){var e=this.man.destinationFolder+\"/\"+this.name+\".js\";fs.writeFileSync(e,this.output)},t.prototype.watch=function(){for(var e in this.layers.layers){var t=this.layers.getLayer(e);t.watch(),t.on(\"file:new\",function(e){this.emit(\"file:new\",e,t),this.bundle()}.bind(this)),t.on(\"file:change\",function(e){this.emit(\"file:change\",e,t),this.bundle()}.bind(this)),t.on(\"file:delete\",function(e){this.emit(\"file:delete\",e,t),this.bundle()}.bind(this))}},t}(events.EventEmitter);exports.Bundle=Bundle;var Collection=function(){function e(){this.bundles={}}return e.prototype.addBundle=function(e){this.bundles[e.name]=e},e.prototype.getBundle=function(e){return this.bundles[e]},e}();exports.Collection=Collection;",
  "bundle/bundle-browser-full.js": "function bundle_browser_full(e,r){var s={\"/lib\":lib};e.conf.volumes.forEach(function(r){s[r[0]]=e.layers.getLayer(r[1]).toJson()});var n={PWD:\"/usr\"};r.env&&(n=extend(n,r.env));var l={expose:!0,platform:\"browser\",env:n,argv:r.argv?r.argv:[\"/usr/index.js\"],drives:s},o=[];o.push('(function(process) { eval(process.drives[\"/lib\"][\"portable.js\"])(process); })('+JSON.stringify(l,null,4)+\");\\n\");var i=o.join(\"\");return i}var fs=require(\"fs\"),extend=require(\"../util/extend\"),lib_json=fs.readFileSync(__dirname+\"/../../build/lib.json\").toString(),lib=JSON.parse(lib_json);module.exports=bundle_browser_full;",
  "bundle/bundle-browser.js": "function bundle_browser(r,e){var o={\"/lib\":lib};r.conf.volumes.forEach(function(e){o[e[0]]=r.layers.getLayer(e[1]).toJson()});var n={PWD:\"/usr\"};e.env&&(n=extend(n,e.env));var s={expose:!0,platform:\"browser\",env:n,argv:e.argv?e.argv:[\"/usr/index.js\"],drives:o},i=[];i.push('(function(process) { eval(process.drives[\"/lib\"][\"portable.js\"])(process); })('+JSON.stringify(s,null,4)+\");\\n\");var l=i.join(\"\");return l}var fs=require(\"fs\"),extend=require(\"../util/extend\"),volpath=__dirname+\"/../../build/libmin.json\";try{var lib_json=fs.readFileSync(volpath).toString(),lib=JSON.parse(lib_json)}catch(e){throw Error(\"Could not find library volume: \"+volpath)}module.exports=bundle_browser;",
  "bundle/bundle-node.js": "function bundle_node(e,o){var n=[];return n.push(wrap[0]+nodefs_js+wrap[1]),n.push(\"\"),e.conf.volumes.forEach(function(o){var r=JSON.stringify(e.layers.getLayer(o[1]).toJson(),null,2);n.push('nodefs.volume.mount(\"'+o[0]+'\", '+r+\");\")}),n.push(\"\"),n.push('require(\"'+e.conf.props.main+'\");'),n.join(\"\\n\")}var fs=require(\"fs\"),uglify=require(\"uglify-js\"),nodefs_js=fs.readFileSync(__dirname+\"/../../node_modules/nodefs/nodefs.js\").toString();nodefs_js=uglify.minify(nodefs_js,{fromString:!0}).code;var wrap=[\"var nodefs = (function() {var module = {};var exports = module.exports = {};\",\"; return module.exports;})();\"];module.exports=bundle_node;",
  "cli.js": "var cli=require(\"cli\"),log=require(\"./log\"),commands=[\"all\",\"paths\",\"layer\",\"merge\",\"bundle\",\"server\"];cli.parse({file:[\"f\",\"portable.js config file location\",\"string\"],\"dont-minify\":[\"m\",\"Disable global minification\"],verbose:[\"v\",\"Aggressively print logs to console\"],debug:[\"\",\"Output debug info\"]},commands),cli.main(function(o,i){try{if(cli.command){if(commands.indexOf(cli.command)<0)throw Error(\"Invalid command: \"+cli.command);var e=require(\"./command/\"+cli.command+\".js\");e(o,i)}else log.error(\"Command not found: \"+cli.command)}catch(l){log.error(l),i.debug&&console.log(l.stack||l)}});",
  "command/bundle.js": "function cmd_bundle(e,i){var n=manifest.Manifest.readFile(i.file),r=Config.getWorkingBundles(n,e);build.Builder.buildBundles(n,r);for(var u in r.bundles){var d=r.bundles[u];d.write()}}var build=require(\"../build\"),manifest=require(\"../manifest\"),Config=require(\"../Config\");module.exports=cmd_bundle;",
  "command/layer.js": "function cmd_layer(e,r){var a,i=manifest.Manifest.readFile(r.file);e&&e.length?(a=new layer.Collection,e.forEach(function(e){var r=i.layers.getLayer(e);if(!r)throw Error(\"Layer not defined: \"+e);a.addLayer(r)})):a=i.layers;build.Builder.buildLayers(i,a)}var build=require(\"../build\"),layer=require(\"../layer\"),manifest=require(\"../manifest\");module.exports=cmd_layer;",
  "command/merge.js": "function cmd_merge(e,r){var i=require(\"../manifest\"),i=i.Manifest.readFile(e[0]);build.Builder.mergeLayers(i)}var build=require(\"../build\");module.exports=cmd_merge;",
  "command/server.js": "function cmd_server(e,r){var s=manifest.Manifest.readFile(r.file),i=Config.getWorkingBundles(s,e),n=new server.Server;n.setManifest(s),n.setBundles(i),n.start(),console.log(\"Press (Ctrl + C) to exit.\")}var manifest=require(\"../manifest\"),server=require(\"../server\"),Config=require(\"../Config\");module.exports=cmd_server;",
  "Config.js": "var bundle=require(\"./bundle\"),Config=function(){function n(){}return n.getWorkingBundles=function(n,e){if(e&&e.length){var r=new bundle.Collection;return e.forEach(function(e){var u=n.bundles.getBundle(e);if(!u)throw Error(\"Bundle not defined: \"+e);r.addBundle(u)}),r}return n.bundles},n}();module.exports=Config;",
  "Drive.js": "var fs=require(\"fs\"),Drive=function(){function t(t){void 0===t&&(t=\"./\"),this.layers=[],this.mountpoints=[],this.mp=t}return t.prototype.addLayer=function(t,i){this.layers.push(t),this.mountpoints.push(i?i:this.mp)},t.prototype.build=function(){var t=this,i=[];return i.push(\"var l = [];\"),i.push(\"var m = [];\"),this.layers.forEach(function(s,n){i.push(\"l[\"+n+\"] = \"+JSON.stringify(s)),i.push(\"m[\"+n+'] = \"'+t.mountpoints[n]+'\"')}),i.join(\"\\n\")},t.prototype.write=function(t){fs.writeFileSync(t,this.build())},t}();module.exports=Drive;",
  "file.js": "var fs=require(\"fs\"),File=function(){function t(t){this.layers=[],this.transformParent=null,this.transform=null,this.filepath=t}return t.prototype.read=function(){this.originalFilepath=this.filepath,this.setSource(fs.readFileSync(this.filepath).toString())},t.prototype.setSource=function(t){this.raw=t},t.prototype.cloneForTransform=function(e){var i=new t(this.filepath);return i.raw=this.raw,i.transform=e,i.transformParent=this,i},t}();exports.File=File;var Collection=function(){function t(){this.files={}}return t.prototype.getFile=function(t){var e=this.files[t];return e?e:this.files[t]=this.readFile(t)},t.prototype.readFile=function(t){var e=new File(t);return e.read(),e},t.prototype.get=function(t){if(!this.files[t]){var e=new File(t);e.read(),this.files[t]=e}return this.files[t]},t.prototype.getFresh=function(t){var e=this.files[t];return e?(e.read(),e):this.get(t)},t}();exports.Collection=Collection;",
  "index.js": "function add_files(e){e.forEach(function(e){var i=e.replace(dir,\".\"),r=function(e){return fs.readFileSync(e).toString()},n=function(e){try{return uglify.minify(e).code}catch(i){return r(e)}};console.log(e),package[i]=n(e)})}var fs=require(\"fs\"),glob=require(\"glob\"),uglify=require(\"uglify-js\"),package={},dir=\"/code/jssh\",files=glob.sync(dir+\"/**/*.+(js|json|md|peg)\");add_files(files);var output=\"archive.json\";console.log(package),fs.writeFileSync(output,JSON.stringify(package,null,2));",
  "layer.js": "var __extends=this.__extends||function(t,r){function e(){this.constructor=t}for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o]);e.prototype=r.prototype,t.prototype=new e},path=require(\"path\"),fs=require(\"fs\"),events=require(\"events\"),glob=require(\"glob\"),watch=require(\"watch\"),minimatch=require(\"minimatch\"),TransformMap=function(){function t(){this.regexes=[],this.transforms=[]}return t.loadTransformFunction=function(t){try{return require(\"portable-transform-\"+t)}catch(r){try{return require(t)}catch(r){try{return require(\"./transform/transform-\"+t)}catch(r){throw Error(\"Could not find transform package: \"+t)}}}},t.prototype.validate=function(t){this.transforms.forEach(function(t,r){if(!(t instanceof Array)||2!=t.length)throw Error(\"In valid transforms configuration: \"+r);if(\"string\"!=typeof t[0])throw Error(\"First transforms argument must be a regular express string.\");if(\"string\"!=typeof t[1]&&\"function\"!=typeof t[1]&&!(t[1]instanceof Array))throw Error(\"Second transforms argument must be a collection of transforms.\")})},t.prototype.loadTransforms=function(r){var e=this;this.validate(r);this.regexes=[],this.transforms=[],r&&r.length&&r.forEach(function(r){var o=r[1]instanceof Array?r[1]:[r[1]],n=[];o.forEach(function(e){if(\"string\"==typeof e)n.push(t.loadTransformFunction(e));else{if(\"function\"!=typeof e)throw Error(\"Unexpected transform definition: \"+r[0]);n.push(e)}}),e.regexes.push(new RegExp(r[0])),e.transforms.push(n)})},t.prototype.applyTransforms=function(t){var r=this;return this.regexes.forEach(function(e,o){t.filepath.match(e)&&r.transforms[o].forEach(function(r){t=t.cloneForTransform(r),r(t)})}),t},t}();exports.TransformMap=TransformMap;var LayerBase=function(t){function r(r,e){t.call(this),this.files={},this.cache={},this.name=r,this.man=e}return __extends(r,t),r.prototype.build=function(){},r.prototype.error=function(t){throw Error(\"Layer (\"+this.name+\"): \"+t)},r.prototype.validateConfig=function(t){},r.prototype.setConfig=function(t){this.validateConfig(t),this.conf=t},r.prototype.getFileName=function(){return this.conf.filename?this.conf.filename:this.name+\".json\"},r.prototype.getFiles=function(){console.log(\"layer files\")},r.prototype.write=function(t){var r=this.getFileName(),e=t+\"/\"+r,o=JSON.stringify(this.cache,null,2);return fs.writeFileSync(e,o),e},r.prototype.toJson=function(){return{}},r.prototype.watch=function(){},r}(events.EventEmitter);exports.LayerBase=LayerBase;var Layer=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.validateConfig=function(t){t.src||this.error(\"Base directory not defined.\"),t.glob instanceof Array&&t.glob.length||this.error(\"No layer globs defined.\"),!t.transform||t.transform instanceof Array||this.error(\"Invalid transforms parameter.\")},r.prototype.setConfig=function(r){\"string\"==typeof r.glob&&(r.glob=[r.glob]),t.prototype.setConfig.call(this,r),this.baseDir=path.resolve(this.man.dir,this.conf.src)+path.sep,r.transform?r.transform[0]instanceof Array||(r.transform=[r.transform]):r.transform=[],this.transformMap=new TransformMap,this.transformMap.loadTransforms(this.conf.transform)},r.prototype.build=function(){this.files=[],this.addFilesByGlobs(),this.populateCache()},r.prototype.populateCache=function(){for(var t in this.files)this.addFileToCache(this.files[t])},r.prototype.addFileToCache=function(t){var r=path.relative(this.baseDir,t.filepath),e=new RegExp(\"\\\\\"+path.sep,\"g\");r=r.replace(e,\"/\"),this.cache[r]=t.raw},r.prototype.toJson=function(){return this.cache},r.prototype.addFile=function(t){return t=this.transformMap.applyTransforms(t),this.files[t.filepath]=t},r.prototype.addFileByPath=function(t){var r=this.man.files.get(t);this.addFile(r)},r.prototype.addFilesByPaths=function(t){t.forEach(this.addFileByPath.bind(this))},r.prototype.addByGlob=function(t){var r=glob.sync(this.baseDir+t);this.addFilesByPaths(r)},r.prototype.addFilesByGlobs=function(){var t=this;this.conf.glob.forEach(function(r){t.addByGlob(r)})},r.prototype.doesMatchGlobs=function(t){for(var r in this.conf.glob){var e=this.conf.glob[r];if(minimatch(t,this.baseDir+e))return!0}return!1},r.prototype.watch=function(){watch.watchTree(this.baseDir,function(t,r,e){if(\"object\"==typeof t&&null===e&&null===r);else if(null===e){if(this.doesMatchGlobs(t)){var o=this.addFile(t);this.addFileToCache(o),this.emit(\"file:new\",o)}}else if(0===r.nlink)console.log(\"removed\",t);else if(this.doesMatchGlobs(t)){var n=this.man.files.getFresh(t),o=this.addFile(n);this.addFileToCache(o),this.emit(\"file:change\",o)}}.bind(this))},r}(LayerBase);exports.Layer=Layer;var LayerMerged=function(t){function r(){t.apply(this,arguments),this.layers=[],this.roots=[]}return __extends(r,t),r}(LayerBase);exports.LayerMerged=LayerMerged;var Collection=function(){function t(){this.layers={}}return t.prototype.addLayer=function(t){this.layers[t.name]=t},t.prototype.getLayer=function(t){return this.layers[t]},t}();exports.Collection=Collection;",
  "log.js": "var logger=require(\"npmlog\");module.exports=logger;",
  "manifest.js": "var path=require(\"path\"),fs=require(\"fs\"),layer=require(\"./layer\"),file=require(\"./file\"),bundle=require(\"./bundle\"),mkdir=require(\"./util/mkdir\"),Manifest=function(){function e(){this.dir=\"\",this.data={},this.destinationFolder=\"\",this.files=new file.Collection,this.layers=new layer.Collection,this.bundles=new bundle.Collection}return e.readFile=function(t){void 0===t&&(t=\"\");var i=new e;return i.readFile(t),i},e.prototype.error=function(e){throw Error(\"Manifest: \"+e+\" (\"+this.filepath+\").\")},e.prototype.readFile=function(t){if(void 0===t&&(t=\"\"),t){if(t=path.resolve(t),!fs.existsSync(t))throw Error(\"Manifest not found: \"+t)}else{for(var i=0;i<e.defaultManifestFiles.length;i++){var r=path.resolve(e.defaultManifestFiles[i]);if(fs.existsSync(r)){t=r;break}}if(!t)throw Error(\"Manifest not found, looking for one of: \"+e.defaultManifestFiles.join(\", \"))}try{t.match(/\\.js$/)?this.data=require(t):this.data=JSON.parse(fs.readFileSync(t).toString())}catch(a){throw Error(\"Config file not found: \"+t)}this.dir=path.dirname(t),this.validate(),this.parse()},e.prototype.validate=function(){\"object\"!=typeof this.data&&this.error(\"Invalid manifest contents\"),this.data.dest&&\"string\"==typeof this.data.dest||this.error(\"Destination `dest` not specified.\"),this.data.layer&&\"object\"==typeof this.data.layer||this.error(\"Layers not defined.\"),this.data.merge&&\"object\"!=typeof this.data.merge&&this.error(\"Invalid `merge` definition.\"),this.data.bundle&&\"object\"!=typeof this.data.bundle&&this.error(\"Invalid `bundle` definition.\")},e.prototype.parse=function(){this.destinationFolder=path.resolve(this.dir,this.data.dest),fs.existsSync(this.destinationFolder)||mkdir(this.destinationFolder);for(var e in this.data.layer){var t=new layer.Layer(e,this);t.setConfig(this.data.layer[e]),this.layers.addLayer(t)}if(this.data.merge)for(var e in this.data.merge){if(this.layers.getLayer(e))throw Error(\"Layer already exists, name `merge` layer differently: \"+e);var i=new layer.LayerMerged(e,this);i.setConfig(this.data.merge[e]),this.layers.addLayer(i)}if(this.data.bundle)for(var r in this.data.bundle){var a=new bundle.Bundle(r,this);a.setConfig(this.data.bundle[r]),this.bundles.addBundle(a)}},e.defaultManifestFiles=[\"portable.js\",\"portable.config.js\",\"portable.json\",\"portable.config.json\"],e}();exports.Manifest=Manifest;",
  "package.js": "var Package=function(){function n(){}return n}();exports.Package=Package;var Collection=function(){function n(){}return n}();exports.Collection=Collection;",
  "package/package-json.js": "function package_json(n){return JSON.stringify(n,null,2)}module.exports=package_json;",
  "server.js": "var log=require(\"./log\"),build=require(\"./build\"),express=require(\"express\"),compression=require(\"compression\"),Server=function(){function e(){this.defaultPort=1777}return e.prototype.setManifest=function(e){this.man=e,this.conf=e.data.server,this.conf||(this.conf={}),this.conf.port||(this.conf.port=this.defaultPort)},e.prototype.setBundles=function(e){this.bundles=e},e.prototype.start=function(){log.info(\"Starting server.\"),build.Builder.buildBundles(this.man,this.man.bundles);var e=this.app=express();e.use(compression()),e.get(\"/\",this.onRouteIndex.bind(this)),e.get(\"/layers/:layer\",this.onRouteLayers.bind(this)),e.get(\"/bundles/:bundle\",this.onRouteBundles.bind(this)),e.listen(this.conf.port),log.info(\"http://127.0.0.1:\"+this.conf.port);for(var t in this.man.bundles.bundles){var n=this.man.bundles.getBundle(t);n.watch(),n.on(\"file:change\",function(e){log.info(\"Modified: \"+e.filepath)}.bind(this)),n.on(\"file:new\",function(e){log.info(\"Added: \"+e.filepath)}.bind(this)),n.on(\"file:delete\",function(e){log.info(\"Removed: \"+e.filepath)}.bind(this)),log.info(\"http://127.0.0.1:\"+this.conf.port+\"/bundles/\"+n.name+\".js\")}},e.prototype.onRouteIndex=function(e,t){t.end([\"/layers\",\"/bundles\"])},e.prototype.onRouteLayers=function(e,t){var n=e.params.layer;t.end(\"layer \"+n)},e.prototype.onRouteBundles=function(e,t){var n=e.params.bundle,o=n.indexOf(\".\");o>-1&&(n=n.substr(0,o));var i=this.man.bundles.getBundle(n);return i?void t.set({\"Content-Type\":i.mimeType}).end(i.output):void t.status(404).set({\"Content-Type\":\"text\"}).end(\"Could not find bundle: \"+n)},e}();exports.Server=Server;",
  "tpl/drive-mount.js": "var drive=nodefs.mount(\"./\",layer);",
  "transform/transform-uglify.js": "function transform_uglify(r){r.raw=uglify.minify(r.raw,{fromString:!0,compress:{dead_code:!0}}).code}var uglify=require(\"uglify-js\");module.exports=transform_uglify;",
  "util/extend.js": "function extend(e,t){e&&\"object\"==typeof e||(e={}),t&&\"object\"==typeof t||(t={});for(var n in t)e[n]=t[n];if(arguments.length>2){var r=[].slice.call(arguments,1);return r[0]=e,extend.apply(this,r)}return e}module.exports=extend;",
  "util/mkdir.js": "function mkdir(r,s){if(!fs.existsSync(r)||!fs.statSync(r).isDirectory()){var t=path.normalize(r).split(path.sep);s=s||process.umask();for(var e=function(r,s){if(fs.existsSync(r)||fs.mkdirSync(r,s),!fs.statSync(r).isDirectory())throw Error(\"Expected directory:\"+r)},i=t[0],a=1;a<t.length;a++)i+=path.sep+t[a],e(i,s)}}var fs=require(\"fs\"),path=require(\"path\");module.exports=mkdir;",
  "watch.js": ""
}