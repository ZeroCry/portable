var fs = require("fs");
var unionfs = (function() {var module = {};var exports = module.exports = {};var UnionFS=function(){function n(){this.UnionFS=n,this.fss=[],this.funcs=[]}return n.prototype.init=function(){for(var t=this,c=0;c<n.sync.length;c++)!function(n){t[n]=function(){return t._syncMethod(n,arguments)}}(n.sync[c]);for(var c=0;c<n.async.length;c++)!function(n){t[n]=function(){t._asyncMethod(n,arguments)}}(n.async[c]);return this},n.prototype.use=function(t){for(var c={},e=0;e<n.sync.length;e++){var r=n.sync[e];c[r]=t[r]}for(var e=0;e<n.async.length;e++){var r=n.async[e];c[r]=t[r]}return this.fss.push(t),this.funcs.push(c),this},n.prototype.replace=function(t){for(var c=0;c<n.sync.length;c++){var e=n.sync[c];t[e]=this[e].bind(this)}for(var c=0;c<n.async.length;c++){var e=n.async[c];t[e]=this[e].bind(this)}return this},n.prototype._syncMethod=function(n,t){for(var c=0;c<this.fss.length;c++){var e=this.fss[c],r=this.funcs[c];try{if(!r[n])throw Error("Method not supported: "+n);return r[n].apply(e,t)}catch(s){if(c>=this.fss.length-1)throw s}}},n.prototype._asyncMethod=function(n,t){t=[].slice.apply(t,0);var c=t.length-1,e=t[c];"function"!=typeof e&&(e=null,c++);var r=function s(r,i){if(void 0===r&&(r=0),r>=this.union.length)return void(e&&e(i?i:Error("No file systems attached.")));t[c]=function(n){return n?s(r+1,n):void(e&&e.apply(e,arguments))};var o=this.fss[r],a=this.funcs[r];a[n]||s(r+1,Error("Method not supported: "+n)),a[n].apply(o,t)}.bind(this);r()},n.sync=["renameSync","ftruncateSync","truncateSync","chownSync","fchownSync","lchownSync","chmodSync","fchmodSync","lchmodSync","statSync","lstatSync","fstatSync","linkSync","symlinkSync","readlinkSync","realpathSync","unlinkSync","rmdirSync","mkdirSync","readdirSync","closeSync","openSync","utimesSync","futimesSync","fsyncSync","writeSync","readSync","readFileSync","writeFileSync","appendFileSync","existsSync","accessSync","createReadStream","createWriteStream","watchFile","unwatchFile","watch"],n.async=["rename","ftruncate","truncate","chown","fchown","lchown","chmod","fchmod","lchmod","stat","lstat","fstat","link","symlink","readlink","realpath","unlink","rmdir","mkdir","readdir","close","open","utimes","futimes","fsync","write","read","readFile","writeFile","appendFile","exists","access"],n}(),unionfs=new UnionFS;unionfs.init(),module.exports=unionfs;; return module.exports;})();
var memfs = (function() {var module = {};var exports = module.exports = {};var __extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},path=require("path"),time=new Date,memfs;!function(t){var e=function(){function t(){this.uid=0,this.gid=0,this.rdev=0,this.blksize=4096,this.ino=0,this.size=0,this.blocks=1,this.atime=time,this.mtime=time,this.ctime=time,this.birthtime=time,this.dev=0,this.mode=0,this.nlink=0,this._isFile=!1,this._isDirectory=!1}return t.build=function(e){var n=new t;if(n.uid=e.uid,n.gid=e.gid,n.atime=e.atime,n.mtime=e.mtime,n.ctime=e.ctime,e instanceof r)n._isDirectory=!0;else if(e instanceof i){var o=e.getData();n.size=o.length,n._isFile=!0}return n},t.prototype.isFile=function(){return this._isFile},t.prototype.isDirectory=function(){return this._isDirectory},t.prototype.isSymbolicLink=function(){return!1},t}();t.Stats=e;var n=function(){function t(e,n){this.fd=t.fd--,this.uid=0,this.gid=0,this.atime=new Date,this.mtime=new Date,this.ctime=new Date,this.relative=e,this.path=path.resolve(n.mountpoint,e),this.layer=n}return t.prototype.getData=function(){return""},t.prototype.setData=function(t){},t.prototype.getPath=function(){return this.path},t.prototype.stats=function(){return e.build(this)},t.prototype.chown=function(t,e){this.uid=t,this.gid=e},t.fd=-1,t}();t.Node=n;var i=function(t){function e(){t.apply(this,arguments),this.position=0}return __extends(e,t),e.prototype.getData=function(){return this.layer.files[this.relative]},e.prototype.setData=function(t){this.layer.files[this.relative]=t.toString()},e.prototype.truncate=function(t){void 0===t&&(t=0),this.setData(this.getData().substr(0,t))},e}(n);t.File=i;var r=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(n);t.Directory=r;var o=function(){function t(t,e){this.files={},this.mountpoint=path.resolve(t),this.files=e}return t}();t.Layer=o;var c=function(){function e(){this.memfs=t,this.flattened={},this.layers=[],this.fds={}}return e.prototype.addDir=function(t,e){var n=path.relative(e.mountpoint,t);n=n.replace(path.sep,"/");var i=new r(n,e);return this.flattened[t]=i,this.fds[i.fd]=i,i},e.prototype.addFile=function(t,e){var n=path.relative(e.mountpoint,t);n=n.replace(path.sep,"/");var r=new i(n,e);this.flattened[t]=r,this.fds[r.fd]=r;for(var o=n.split("/"),c="",s=0;s<o.length-1;s++){c+=o[s]+(c?path.sep:"");var a=e.mountpoint+path.sep+c;this.addDir(a,e)}return r},e.prototype.addLayer=function(t){this.layers.push(t);var e=path.resolve(t.mountpoint)+path.sep;for(var n in t.files){var i=n.replace("/",path.sep),r=e+i;this.addFile(r,t)}},e.prototype.getFilePath=function(t){var e=path.resolve(t),n=this.getNode(e);return n?n:null},e.prototype.getNode=function(t){var e=path.resolve(t),n=this.flattened[e];if(!n)throw this.err404(e);return n},e.prototype.getFile=function(t){var e=this.getNode(t);if(e instanceof i)return e;throw this.err404(e.path)},e.prototype.getDirectory=function(t){var e=this.getNode(t);if(e instanceof r)return e;throw Error("Directory not found: "+e.path)},e.prototype.getByFd=function(t){var e=this.fds[t];if(e)return e;throw Error("Node file descriptor not found: "+t)},e.prototype.getLayerContainingPath=function(t){for(var e=0;e<this.layers.length;e++){var n=this.layers[e];if(0===t.indexOf(n.mountpoint))return n}return null},e.prototype.err404=function(t){return Error("File not found: "+t)},e.prototype.mountSync=function(t,e){var n=new o(t,e);this.addLayer(n)},e.prototype.mount=function(t,e,n){},e.prototype.readFileSync=function(t,e){var n=this.getFile(t);if(e)return n.getData();var i=require("buffer").Buffer;return new i(n.getData())},e.prototype.readFile=function(t,e,n){"function"==typeof e&&(n=e,e={});try{var i=(this.getFile(t),this);process.nextTick(function(){var r=i.readFileSync(t,e);n(null,r)})}catch(r){n(r)}},e.prototype.realpathSync=function(t,e){var n=this.getNode(t);return n.path},e.prototype.realpath=function(t,e,n){"function"==typeof e&&(n=e);var i=this;process.nextTick(function(){try{n(null,i.realpathSync(t,e))}catch(r){n(r)}})},e.prototype.statSync=function(t){var e=this.getNode(t);return e.stats()},e.prototype.lstatSync=function(t){return this.statSync(t)},e.prototype.stat=function(t,e){var n=this;process.nextTick(function(){try{e(null,n.statSync(t))}catch(i){e(i)}})},e.prototype.lstat=function(t,e){this.stat(t,e)},e.prototype.renameSync=function(t,e){var n=this.getNode(t);t=n.path,e=path.resolve(e),delete this.flattened[t],this.flattened[e]=n,n.path=e,n.relative=path.relative(n.layer.mountpoint,e)},e.prototype.rename=function(t,e,n){var i=this;process.nextTick(function(){try{i.renameSync(t,e),n&&n()}catch(r){n&&n(r)}})},e.prototype.fstatSync=function(t){var e=this.getByFd(t);return e.stats()},e.prototype.fstat=function(t,e){var n=this;process.nextTick(function(){try{e(null,n.fstatSync(t))}catch(i){e(i)}})},e.prototype.writeFileSync=function(t,e,n){var i=this.getFile(t);i.setData(e)},e.prototype.writeFile=function(t,e,n,i){"function"==typeof n&&(i=n,n=null);var r=this;process.nextTick(function(){try{r.writeFileSync(t,e,n),i&&i()}catch(o){i&&i(o)}})},e.prototype.existsSync=function(t){try{return this.getNode(t),!0}catch(e){return!1}},e.prototype.exists=function(t,e){var n=this;process.nextTick(function(){e(n.existsSync(t))})},e.prototype.readdirSync=function(t){var e=path.resolve(t);if(!this.getLayerContainingPath(e))throw Error("Directory not found: "+e);var n=e.length,i={};for(var r in this.flattened)if(0===r.indexOf(e)){var o=r.substr(n+1),c=o.indexOf(path.sep);c>-1&&(o=o.substr(0,c)),o&&(i[o]=1)}var s=[];for(var a in i)s.push(a);return s},e.prototype.readdir=function(t,e){var n=this;process.nextTick(function(){try{e(null,n.readdirSync(t))}catch(i){e(i)}})},e.prototype.appendFileSync=function(t,e,n){try{var i=this.getFile(t);i.setData(i.getData()+e.toString())}catch(r){var o=path.resolve(t),c=this.getLayerContainingPath(o);if(!c)throw Error("Cannot create new file at this path: "+o);var i=this.addFile(o,c);i.setData(e.toString())}},e.prototype.appendFile=function(t,e,n,i){"function"==typeof n&&(i=n,n=null);var r=this;process.nextTick(function(){try{r.appendFileSync(t,e,n),i&&i()}catch(o){i&&i(o)}})},e.prototype.unlinkSync=function(t){var e=this.getNode(t);delete e.layer.files[e.relative],delete this.flattened[e.path],delete this.fds[e.fd]},e.prototype.unlink=function(t,e){var n=this;process.nextTick(function(){try{n.unlinkSync(t),e&&e()}catch(i){e&&e(i)}})},e.prototype.truncateSync=function(t,e){var n=this.getFile(t);n.truncate(e)},e.prototype.truncate=function(t,e,n){var i=this;process.nextTick(function(){try{i.truncateSync(t,e),n&&n()}catch(r){n&&n(r)}})},e.prototype.ftruncateSync=function(t,e){var n=this.getByFd(t);n instanceof i||this.err404(n.path),n.truncate(e)},e.prototype.ftruncate=function(t,e,n){var i=this;process.nextTick(function(){try{i.ftruncateSync(t,e),n&&n()}catch(r){n&&n(r)}})},e.prototype.chownSync=function(t,e,n){var i=this.getNode(t);i.chown(e,n)},e.prototype.chown=function(t,e,n,i){var r=this;process.nextTick(function(){try{r.chownSync(t,e,n),i&&i()}catch(o){i&&i(o)}})},e.prototype.fchownSync=function(t,e,n){var i=this.getByFd(t);i.chown(e,n)},e.prototype.fchown=function(t,e,n,i){var r=this;process.nextTick(function(){try{r.fchownSync(t,e,n),i&&i()}catch(o){i&&i(o)}})},e.prototype.lchownSync=function(t,e,n){this.chownSync(t,e,n)},e.prototype.lchown=function(t,e,n,i){this.chown(t,e,n,i)},e.prototype.chmodSync=function(t,e){this.getNode(t)},e.prototype.chmod=function(t,e,n){var i=this;process.nextTick(function(){try{i.chmodSync(t,e),n&&n()}catch(r){n&&n(r)}})},e.prototype.fchmodSync=function(t,e){this.getByFd(t)},e.prototype.fchmod=function(t,e,n){var i=this;process.nextTick(function(){try{i.fchmodSync(t,e),n&&n()}catch(r){n&&n(r)}})},e.prototype.lchmodSync=function(t,e){this.chmodSync(t,e)},e.prototype.lchmod=function(t,e,n){this.chmod(t,e,n)},e.prototype.rmdirSync=function(t){var e=this.getDirectory(t);delete this.flattened[e.path],delete this.fds[e.fd]},e.prototype.rmdir=function(t,e){var n=this;process.nextTick(function(){try{n.rmdirSync(t),e&&e()}catch(i){e&&e(i)}})},e.prototype.openSync=function(t,e,n){var i=this.getFile(t);return i.fd},e.prototype.open=function(t,e,n,i){"function"==typeof n&&(i=n,n=438);var r=this;process.nextTick(function(){try{i(null,r.openSync(t,e,n))}catch(o){i(o)}})},e.prototype.utimesSync=function(t,e,n){var i=this.getNode(t);i.atime=e,i.mtime=n},e.prototype.utimes=function(t,e,n,i){var r=this;process.nextTick(function(){try{i(null,r.utimesSync(t,e,n))}catch(o){i(o)}})},e.prototype.futimesSync=function(t,e,n){var i=this.getByFd(t);i.atime=e,i.mtime=n},e.prototype.futimes=function(t,e,n,i){var r=this;process.nextTick(function(){try{i(null,r.futimesSync(t,e,n))}catch(o){i(o)}})},e.prototype.accessSync=function(t,e){this.getNode(t)},e.prototype.access=function(t,e,n){"function"==typeof e&&(n=e,e=7);var i=this;process.nextTick(function(){try{i.accessSync(t,e),n()}catch(r){n(r)}})},e.prototype.closeSync=function(t){this.getNode(t)},e.prototype.close=function(t,e){var n=this;process.nextTick(function(){try{n.closeSync(t),e&&e()}catch(i){e&&e(i)}})},e.prototype.mkdirSync=function(t,e){var n=path.resolve(t),i=this.getLayerContainingPath(n);if(!i)throw Error("Cannot create directory at this path: "+n);this.addDir(n,i)},e.prototype.mkdir=function(t,e,n){"function"==typeof e&&(n=e,e=511);var i=this;process.nextTick(function(){try{i.mkdirSync(t,e),n&&n()}catch(r){n&&n(r)}})},e.prototype.writeSync=function(t,e,n,r){var o=this.getByFd(t);if(!(o instanceof i))throw Error("Is not a file: "+o.path);var c=require("buffer").Buffer;if(e instanceof c){var s=e,a=n,p=r;n=arguments[4],e=s.slice(a,p),e=e.toString()}else e=e.toString();"undefined"==typeof n&&(n=o.position);var h=o.getData();return h=h.substr(0,n)+e+h.substr(n+e.length),o.setData(h),o.position=n+e.length,c.byteLength(e,r)},e.prototype.write=function(t,e,n,i,r,o){"function"==typeof r&&(o=r,r=void 0),"function"==typeof i&&(o=i,i=r=void 0),"function"==typeof n&&(o=n,n=i=r=void 0);var c=this;process.nextTick(function(){try{var s=c.writeSync(t,e,n,i,r);o&&o(null,s)}catch(a){o&&o(a)}})},e.prototype.readSync=function(t,e,n,r,o){var c=this.getByFd(t);if(!(c instanceof i))throw Error("Not a file: "+c.path);var s=c.getData();null===o&&(o=c.position);var a=s.substr(o,r);return e.write(a,n,r),a.length},e.prototype.read=function(t,e,n,i,r,o){var c=this;process.nextTick(function(){try{var s=c.readSync(t,e,n,i,r);o(null,s,e)}catch(a){o(a)}})},e.prototype.linkSync=function(t,e){var n=this.getNode(t);if(e=path.resolve(e),this.flattened[e])throw Error("Destination path already in use: "+e);this.flattened[e]=n},e.prototype.link=function(t,e,n){var i=this;process.nextTick(function(){try{i.linkSync(t,e),n&&n()}catch(r){n&&n(r)}})},e.prototype.symlinkSync=function(t,e,n){this.linkSync(t,e)},e.prototype.symlink=function(t,e,n,i){"function"==typeof n&&(i=n,n=void 0),this.link(t,e,i)},e.prototype.readlinkSync=function(t){var e=this.getNode(t);return e.path},e.prototype.readlink=function(t,e){var n=this;process.nextTick(function(){try{e(null,n.readlinkSync(t))}catch(i){e(i)}})},e.prototype.fsyncSync=function(t){this.getByFd(t)},e.prototype.fsync=function(t,e){var n=this;process.nextTick(function(){try{n.fsyncSync(t),e&&e()}catch(i){e&&e(i)}})},e.prototype.createReadStream=function(t,e){function n(t){c.call(this,t),this.done=!1}e=e||{};var r=e.fd?this.getByFd(e.fd):this.getFile(t);if(!(r instanceof i))throw Error("Not a file: "+r.path);var o=require("util"),c=require("stream").Readable,s=require("buffer").Buffer;return o.inherits(n,c),n.prototype._read=function(){this.done?this.push(null):(this.push(new s(r.getData())),this.done=!0)},new n},e.prototype.createWriteStream=function(t,e){function n(t){c.call(this,t)}e=e||{};var r=e.fd?this.getByFd(e.fd):this.getFile(t);if(!(r instanceof i))throw Error("Not a file: "+r.path);e.start&&(r.position=e.start);var o=require("util"),c=require("stream").Writable;require("buffer").Buffer;return o.inherits(n,c),n.prototype._write=function(t){t=t.toString();var e=r.getData();e=e.substr(0,r.position)+t+e.substr(r.position+t.length),r.setData(e),r.position+=t.length},new n},e}();t.Volume=c}(memfs||(memfs={})),module.exports=memfs;; return module.exports;})();

var mem = new memfs.Volume;
mem.mountSync("/app", {
  "index.js": "\n\nconsole.log(12345);\n\n"
});

unionfs
    .use(fs)
    .use(mem)
    .replace(fs);

require("/app/index.js");